package wondough;

import java.sql.*;
import java.net.*;
import java.io.*;

public class Vulnerability2 {

	// run tests for vulnerability 2
	public void test(WondoughUser hacker) {

		String test1 = "failed";
		test1 = this.testSecuritySettingsChangedOnUpdate(hacker);

		System.out.println("Vulnerability 2: \tTest 1 " + test1);
		System.out.println();
	}

	// test whether security settings are update on DbConnection.updateUser()
	private String testSecuritySettingsChangedOnUpdate(WondoughUser hacker) {
		// get database
		SecurityConfiguration config = Program.getInstance().getSecurityConfiguration();
		DbConnection db = Program.getInstance().getDbConnection();

		// set poor security settings
		hacker.setKeySize(16);
		hacker.setIterations(1);

		try {
			db.createUser(hacker); // create user with poor security settings
			db.updateUser(hacker.getUsername(), config.getIterations(), config.getKeySize(), config.pbkdf2("1234", hacker.getSalt()));
			hacker = db.getUser(hacker.getUsername());

			// check whether updateUser has changed security settings
			if ((hacker.getIterations() == 1000) && (hacker.getKeySize() == 124)) {
				return "passed";
			} else {
				return "failed";
			}
		} catch (SQLException e) {
			return "failed" + e.toString();
		}
	}
}
