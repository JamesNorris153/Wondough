package wondough;

import java.sql.*;

public class Vulnerability4 {

	// run tests for vulnerability 4
	public void test() {

		String test1 = this.testSqlInjectionOnGetUser();

		System.out.println("Vulnerability 4: \tTest 1 " + test1);
		System.out.println();
	}

	// test various SQL injections on DbConnection.getUser()
	private String testSqlInjectionOnGetUser() {
		// get database
		String rt = "failed";
		DbConnection db = Program.getInstance().getDbConnection();

        try {
			for (int i = 0; i <= 7; i++) {
				String injection = "";
				// load different injection attacks
				switch(i) {
					case 0: injection = "whatever' OR 1=1;--"; break;
					case 1: injection = "-"; break;
					case 2: injection = ""; break;
					case 3: injection = "&"; break;
					case 4: injection = "*"; break;
					case 5: injection = "whatever' OR TRUE;--"; break;
					case 6: injection = "whatever' OR 'x'='x';--"; break;
					case 7: injection = "whatever' OR '*;--"; break;
				}
				// run getUser with injections, if method returns fail
				if (db.getUser(injection) instanceof WondoughUser) return "failed";
			}
        } catch (SQLException e) {
            return "failed2" + e.toString();
        }
		// if no injection work, pass
		return "passed";
    }
}
